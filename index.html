<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Cuba Market - Tienda PRO</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
    margin:0;
    font-family:Arial,sans-serif;
    background:#f2f2f2;
}
header{
    background:#009933;
    padding:15px;
    color:white;
    text-align:center;
    font-size:28px;
    font-weight:bold;
}
#totalTop{
    background:black;
    color:lime;
    padding:10px;
    text-align:center;
    font-size:18px;
}
.container{
    max-width:1100px;
    margin:auto;
    padding:20px;
}
.search{
    width:100%;
    padding:12px;
    border-radius:10px;
    border:1px solid gray;
    font-size:16px;
}
.products{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
    gap:15px;
    margin-top:20px;
}
.card{
    background:white;
    border-radius:15px;
    padding:15px;
    box-shadow:0 0 10px rgba(0,0,0,0.2);
    text-align:center;
    transition:0.2s;
}
.card:hover{
    transform:scale(1.03);
}
.card h3{
    margin:8px 0;
}
button{
    padding:10px 15px;
    margin:5px;
    border:none;
    border-radius:10px;
    cursor:pointer;
    background:#009933;
    color:white;
    font-weight:bold;
}
button:hover{
    opacity:0.85;
}
#cartPanel{
    position:fixed;
    right:0;
    top:0;
    width:350px;
    height:100%;
    background:white;
    box-shadow:-5px 0 15px rgba(0,0,0,0.3);
    padding:15px;
    overflow:auto;
    display:none;
}
.cartItem{
    border-bottom:1px solid #ddd;
    padding:8px;
}
.cartItem span{
    font-weight:bold;
}
.toggleBox{
    background:#eee;
    padding:10px;
    border-radius:10px;
    margin-top:10px;
    cursor:pointer;
    font-weight:bold;
}
.contentBox{
    display:none;
    padding:10px;
}
input,select{
    width:95%;
    padding:8px;
    margin:5px 0;
    border-radius:8px;
    border:1px solid gray;
}
</style>
</head>

<body>

<header>üá®üá∫ CUBA MARKET</header>

<div id="totalTop">Total actual: 0 CUP</div>

<div class="container">

<input class="search" placeholder="Buscar productos..." onkeyup="buscarProducto(this.value)">

<div class="products" id="listaProductos"></div>

<button onclick="mostrarCarrito()">üõí Ver Carrito</button>

</div>

<!-- PANEL CARRITO -->
<div id="cartPanel">

<h2>üõç Carrito</h2>
<div id="cartItems"></div>

<h3 id="subtotalTxt">Subtotal: 0 CUP</h3>
<h3 id="totalTxt">Total: 0 CUP</h3>

<!-- CUP√ìN -->
<div class="toggleBox" onclick="togglePanel('promoPanel')">üéü C√≥digo Promocional</div>
<div class="contentBox" id="promoPanel">
<input id="promoCode" placeholder="Ej: CUBA10">
<button onclick="aplicarPromo()">Aplicar</button>
</div>

<!-- CLIENTE -->
<div class="toggleBox" onclick="togglePanel('clientePanel')">üë§ Datos del Cliente</div>
<div class="contentBox" id="clientePanel">
<input id="nombreCliente" placeholder="Nombre y apellidos">
<input id="direccionCliente" placeholder="Direcci√≥n">
<input id="telefonoCliente" placeholder="Tel√©fono">
<input id="ciCliente" placeholder="Carnet de identidad">
<input id="quienRecibe" placeholder="Qui√©n recibe">
<input id="quienPaga" placeholder="Qui√©n paga">
<select id="entrega">
<option>Recoger en tienda</option>
<option>Mensajer√≠a</option>
</select>
</div>

<!-- PAGO -->
<div class="toggleBox" onclick="togglePanel('pagoPanel')">üí≥ M√©todos de Pago</div>
<div class="contentBox" id="pagoPanel">
<select id="metodoPago">
<option>CUP - Cuenta 839201</option>
<option>USD - Cuenta 551920</option>
<option>MLC - Cuenta 992145</option>
<option>CRIPTO - Wallet TRX 8F3A</option>
<option>CLASICA - Cuenta 110203</option>
</select>
</div>

<!-- BOTONES -->
<button onclick="facturaPDF()">üìÑ Descargar Factura</button>
<button onclick="comprobantePDF()">üßæ Descargar Comprobante</button>

<button onclick="enviarWhatsApp()">üì≤ Enviar Pedido</button>

<button onclick="ocultarCarrito()">‚ùå Ocultar</button>

<button style="background:gray;">üëõ Billetera</button>

</div>

<script>
/* PRODUCTOS */
let productos=[
{name:"Pollo 1kg",precio:1200},
{name:"Arroz 1kg",precio:350},
{name:"Aceite 1L",precio:1500},
{name:"Az√∫car 1kg",precio:280},
{name:"Galletas",precio:500},
{name:"Leche en polvo",precio:2500},
{name:"Caf√© 250g",precio:1800},
{name:"Jam√≥n",precio:2200},
{name:"Queso",precio:2400},
{name:"Refresco",precio:300},
{name:"Pan",precio:100},
{name:"Huevos (10)",precio:900},
{name:"Spaghetti",precio:400},
{name:"Harina",precio:320},
{name:"Sal",precio:150},
{name:"Chocolate",precio:600},
{name:"Mermelada",precio:750},
{name:"Mayonesa",precio:950},
{name:"At√∫n",precio:1300},
{name:"Frijoles",precio:450}
];

let carrito={};
let descuentoActivo=0;

/* MOSTRAR PRODUCTOS */
function cargarProductos(){
 let cont=document.getElementById("listaProductos");
 cont.innerHTML="";
 productos.forEach((p,i)=>{
   cont.innerHTML+=`
   <div class="card">
    <h3>${p.name}</h3>
    <p>${p.precio} CUP</p>
    <button onclick="agregar(${i})">A√±adir</button>
   </div>`;
 });
}
cargarProductos();

/* BUSCADOR */
function buscarProducto(txt){
 let cont=document.getElementById("listaProductos");
 cont.innerHTML="";
 productos.filter(p=>p.name.toLowerCase().includes(txt.toLowerCase()))
 .forEach((p,i)=>{
   cont.innerHTML+=`
   <div class="card">
    <h3>${p.name}</h3>
    <p>${p.precio} CUP</p>
    <button onclick="agregar(${productos.indexOf(p)})">A√±adir</button>
   </div>`;
 });
}

/* CARRITO */
function agregar(i){
 let p=productos[i];
 if(!carrito[p.name]) carrito[p.name]={...p,cant:1};
 else carrito[p.name].cant++;
 actualizarCarrito();
}
function restar(nombre){
 if(carrito[nombre].cant>1) carrito[nombre].cant--;
 else delete carrito[nombre];
 actualizarCarrito();
}
function eliminar(nombre){
 delete carrito[nombre];
 actualizarCarrito();
}

/* ACTUALIZAR */
function actualizarCarrito(){
 let div=document.getElementById("cartItems");
 div.innerHTML="";
 let subtotal=0;

 Object.values(carrito).forEach(p=>{
   subtotal+=p.precio*p.cant;
   div.innerHTML+=`
   <div class="cartItem">
    <span>${p.name}</span><br>
    Cant: ${p.cant} 
    <button onclick="agregar(${productos.findIndex(x=>x.name==p.name)})">+</button>
    <button onclick="restar('${p.name}')">-</button>
    <button onclick="eliminar('${p.name}')">Eliminar</button>
   </div>`;
 });

 let desc=subtotal*descuentoActivo;
 let total=subtotal-desc;

 document.getElementById("subtotalTxt").innerText="Subtotal: "+subtotal+" CUP";
 document.getElementById("totalTxt").innerText="Total: "+total.toFixed(2)+" CUP";
 document.getElementById("totalTop").innerText="Total actual: "+total.toFixed(2)+" CUP";
}

/* CUP√ìN */
function aplicarPromo(){
 let code=document.getElementById("promoCode").value.toUpperCase();
 if(code==="CUBA10"){
   descuentoActivo=0.10;
   alert("‚úÖ Cup√≥n aplicado 10%");
 }else{
   descuentoActivo=0;
   alert("‚ùå C√≥digo inv√°lido");
 }
 actualizarCarrito();
}

/* PANELES */
function togglePanel(id){
 let box=document.getElementById(id);
 box.style.display=(box.style.display=="block")?"none":"block";
}

/* MOSTRAR/OCULTAR */
function mostrarCarrito(){
 document.getElementById("cartPanel").style.display="block";
}
function ocultarCarrito(){
 document.getElementById("cartPanel").style.display="none";
}

/* WHATSAPP */
function enviarWhatsApp(){
 let total=document.getElementById("totalTxt").innerText;
 let msg="Hola, quiero hacer este pedido:%0A";

 Object.values(carrito).forEach(p=>{
   msg+=`${p.name} x${p.cant}%0A`;
 });

 msg+=`%0A${total}`;
 window.open("https://wa.me/58752291?text="+msg);
}

/* PDF FACTURA */
function facturaPDF(){
 const {jsPDF}=window.jspdf;
 let doc=new jsPDF();
 let y=20;

 doc.setFontSize(18);
 doc.text("CUBA MARKET - FACTURA",60,y);

 y+=15;
 doc.setFontSize(12);
 doc.text("Cliente: "+document.getElementById("nombreCliente").value,15,y); y+=8;
 doc.text("Direccion: "+document.getElementById("direccionCliente").value,15,y); y+=8;
 doc.text("Telefono: "+document.getElementById("telefonoCliente").value,15,y); y+=8;

 y+=10;
 doc.text("PRODUCTOS:",15,y); y+=8;

 let subtotal=0;
 Object.values(carrito).forEach(p=>{
   let total=p.precio*p.cant;
   subtotal+=total;
   doc.text(`${p.name} x${p.cant} = ${total} CUP`,15,y);
   y+=7;
 });

 let desc=subtotal*descuentoActivo;
 let totalFinal=subtotal-desc;

 y+=10;
 doc.text("Subtotal: "+subtotal+" CUP",15,y); y+=7;

 if(descuentoActivo>0){
   doc.text("Descuento 10% aplicado por cup√≥n",15,y); y+=7;
 }

 doc.text("TOTAL: "+totalFinal.toFixed(2)+" CUP",15,y);

 y+=15;
 doc.text("Gracias por su compra ‚ù§Ô∏è",15,y);

 doc.save("Factura_CubaMarket.pdf");
}

/* PDF COMPROBANTE */
function comprobantePDF(){
 const {jsPDF}=window.jspdf;
 let doc=new jsPDF();
 let y=25;

 doc.setFontSize(16);
 doc.text("COMPROBANTE DE PAGO",60,y);

 y+=15;
 let metodo=document.getElementById("metodoPago").value;
 doc.text("Metodo: "+metodo,15,y); y+=10;

 doc.text("Cliente: "+document.getElementById("nombreCliente").value,15,y);

 doc.save("Comprobante_Pago.pdf");
}
</script>

</body>
</html>
