<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Cuba Market - Tienda Oficial</title>

<style>
body{
    margin:0;
    font-family: Arial, sans-serif;
    background:linear-gradient(120deg,#e8ffef,#fff8c6);
    color:#222;
    text-align:center;
}
h1{
    margin:15px;
    font-size:42px;
    color:#2e7d32;
}
#totalArriba{
    font-size:22px;
    font-weight:bold;
    color:#d32f2f;
    margin-bottom:15px;
}
.productos{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(190px,1fr));
    gap:15px;
    max-width:1200px;
    margin:20px auto;
    padding:15px;
}
.card{
    background:white;
    border-radius:18px;
    padding:15px;
    box-shadow:0 0 12px rgba(0,0,0,0.2);
    transition:0.2s;
}
.card:hover{transform:scale(1.03);}
.card button{
    margin-top:10px;
    padding:10px 15px;
    border:none;
    border-radius:12px;
    cursor:pointer;
    background:#43a047;
    color:white;
    font-weight:bold;
}
.toggleBtn{
    background:#1976d2;
    color:white;
    padding:12px 20px;
    border:none;
    border-radius:14px;
    cursor:pointer;
    margin:10px;
    font-weight:bold;
}
details{
    max-width:750px;
    margin:15px auto;
    text-align:left;
    background:white;
    border-radius:15px;
    padding:12px;
    box-shadow:0 0 10px rgba(0,0,0,0.2);
}
summary{
    font-size:18px;
    font-weight:bold;
    cursor:pointer;
}
input,select{
    width:95%;
    padding:8px;
    margin:5px 0;
    border-radius:10px;
    border:1px solid #aaa;
}
.panel{
    position:fixed;
    top:0;
    width:350px;
    height:100%;
    background:white;
    box-shadow:0 0 15px rgba(0,0,0,0.3);
    padding:15px;
    overflow:auto;
    display:none;
    z-index:999;
}
#carritoPanel{ right:0; }
#walletPanel{ left:0; }

.itemCarrito{
    border-bottom:1px solid #ddd;
    padding:10px;
}
.itemCarrito button{
    margin:3px;
    padding:5px 10px;
    border:none;
    border-radius:8px;
    cursor:pointer;
}
.btnMas{background:#2e7d32;color:white;}
.btnMenos{background:#ff9800;color:white;}
.btnEliminar{background:#d32f2f;color:white;}

.btnFactura{background:#2e7d32;color:white;padding:10px;border:none;border-radius:12px;margin:5px;}
.btnWhats{background:#25d366;color:white;padding:10px;border:none;border-radius:12px;margin:5px;}
.btnComp{background:#1976d2;color:white;padding:10px;border:none;border-radius:12px;margin:5px;}
</style>
</head>

<body>

<h1>CUBA MARKET</h1>
<div id="totalArriba">TOTAL ACTUAL: 0 CUP</div>

<button class="toggleBtn" onclick="mostrarCarrito()">Carrito</button>

<input type="text" id="buscador" placeholder="Buscar productos..." onkeyup="filtrarProductos()">

<div class="productos" id="listaProductos"></div>

<!-- CLIENTE -->
<details>
<summary>Datos del Cliente</summary>
<input id="clienteNombre" placeholder="Nombre y Apellidos">
<input id="clienteDireccion" placeholder="Dirección">
<input id="clienteTelefono" placeholder="Teléfono">
<input id="clienteCI" placeholder="Carnet de Identidad">
<input id="quienRecibe" placeholder="Quién recibe">
<input id="quienPaga" placeholder="Quién paga">
<select id="entrega">
<option>Recoger en tienda</option>
<option>Mensajería</option>
</select>
</details>

<!-- PAGO -->
<details>
<summary>Método de Pago</summary>
<select id="metodoPago">
<option value="">Elegir método</option>
<option>CRIPTO (928374)</option>
<option>CUP (837261)</option>
<option>USD (112233)</option>
<option>MLC (445566)</option>
<option>CLÁSICA (778899)</option>
</select>
</details>

<!-- CUPÓN -->
<details>
<summary>Cupón Promocional</summary>
<input id="cupon" placeholder="Código: TIENDA10">
<button onclick="aplicarCupon()">Aplicar</button>
<p id="estadoCupon"></p>
</details>

<!-- CARRITO -->
<div class="panel" id="carritoPanel">
<h2>Tu Carrito</h2>
<div id="carritoItems"></div>

<h3 id="subtotalCarrito"></h3>
<h3 id="descuentoCarrito"></h3>
<h2 id="totalCarrito"></h2>

<button class="btnFactura" onclick="generarFactura()">Factura PDF</button>
<button class="btnComp" onclick="generarComprobante()">Comprobante PDF</button>
<button class="btnWhats" onclick="enviarWhats()">Enviar WhatsApp</button>
<button onclick="ocultarCarrito()">Cerrar</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
let productos=[
 {nombre:"Pollo entero",precio:2200},
 {nombre:"Arroz 1kg",precio:750},
 {nombre:"Huevos 30 uds",precio:3000},
 {nombre:"Aceite 1L",precio:1400},
 {nombre:"Azúcar 1kg",precio:300},
 {nombre:"Café 250g",precio:2200},
 {nombre:"Frijoles 1lb",precio:500},
 {nombre:"Carne de cerdo 1kg",precio:1300},
 {nombre:"Carne de res 1kg",precio:1800},
 {nombre:"Queso 1kg",precio:2600}
];

let carrito=[];
let descuento=0;
let codigoAplicado="";

function cargarProductos(lista=productos){
 let cont=document.getElementById("listaProductos");
 cont.innerHTML="";
 lista.forEach(p=>{
   cont.innerHTML+=`
   <div class="card">
    <h3>${p.nombre}</h3>
    <p>${p.precio} CUP</p>
    <button onclick="agregarCarrito('${p.nombre}')">Añadir</button>
   </div>`;
 });
}
cargarProductos();

function filtrarProductos(){
 let texto=document.getElementById("buscador").value.toLowerCase();
 cargarProductos(productos.filter(p=>p.nombre.toLowerCase().includes(texto)));
}

function agregarCarrito(nombre){
 let prod=productos.find(p=>p.nombre==nombre);
 let existe=carrito.find(x=>x.nombre==nombre);
 if(existe) existe.cantidad++;
 else carrito.push({nombre:prod.nombre,precio:prod.precio,cantidad:1});
 actualizarCarrito();
}

function actualizarCarrito(){
 let div=document.getElementById("carritoItems");
 div.innerHTML="";
 let subtotal=0;

 carrito.forEach(it=>{
   subtotal+=it.precio*it.cantidad;
   div.innerHTML+=`${it.nombre} x${it.cantidad} = ${it.precio*it.cantidad} CUP<br>`;
 });

 let montoDescuento=subtotal*descuento;
 let total=subtotal-montoDescuento;

 document.getElementById("subtotalCarrito").innerText="Subtotal: "+subtotal+" CUP";
 document.getElementById("descuentoCarrito").innerText=
 descuento>0 ? `Descuento 10% (${codigoAplicado}): -${montoDescuento}` : "";
 document.getElementById("totalCarrito").innerText="TOTAL: "+total+" CUP";
 document.getElementById("totalArriba").innerText="TOTAL ACTUAL: "+total+" CUP";
}

function aplicarCupon(){
 let c=document.getElementById("cupon").value.trim();
 if(c=="TIENDA10"){
   descuento=0.10;
   codigoAplicado=c;
   document.getElementById("estadoCupon").innerText="Cupón aplicado";
 }else{
   descuento=0;
   codigoAplicado="";
   document.getElementById("estadoCupon").innerText="Cupón inválido";
 }
 actualizarCarrito();
}

function mostrarCarrito(){document.getElementById("carritoPanel").style.display="block";}
function ocultarCarrito(){document.getElementById("carritoPanel").style.display="none";}

/* FACTURA PDF COMPLETA */
function generarFactura(){
 const {jsPDF}=window.jspdf;
 let doc=new jsPDF();

 let nombre=document.getElementById("clienteNombre").value;
 let direccion=document.getElementById("clienteDireccion").value;
 let telefono=document.getElementById("clienteTelefono").value;
 let entrega=document.getElementById("entrega").value;
 let pago=document.getElementById("metodoPago").value;

 doc.setFontSize(16);
 doc.text("FACTURA - CUBA MARKET",20,20);

 doc.setFontSize(12);
 doc.text("Cliente: "+nombre,20,35);
 doc.text("Direccion: "+direccion,20,43);
 doc.text("Telefono: "+telefono,20,51);
 doc.text("Entrega: "+entrega,20,59);
 doc.text("Pago: "+pago,20,67);

 let y=85;
 let subtotal=0;
 carrito.forEach(it=>{
   subtotal+=it.precio*it.cantidad;
   doc.text(`${it.nombre} x${it.cantidad}`,20,y);
   y+=8;
 });

 let montoDescuento=subtotal*descuento;
 let total=subtotal-montoDescuento;

 y+=10;
 doc.text("Subtotal: "+subtotal+" CUP",20,y);
 y+=8;
 if(descuento>0){
   doc.text("Descuento 10% ("+codigoAplicado+"): -"+montoDescuento+" CUP",20,y);
   y+=8;
 }
 doc.text("TOTAL FINAL: "+total+" CUP",20,y);

 doc.text("Gracias por tu compra.",20,y+20);

 doc.save("factura_cubamarket.pdf");
}

/* COMPROBANTE PDF */
function generarComprobante(){
 const {jsPDF}=window.jspdf;
 let doc=new jsPDF();
 doc.text("COMPROBANTE DE PAGO - CUBA MARKET",20,20);
 doc.text("Enviar factura + captura del pago por WhatsApp.",20,40);
 doc.save("comprobante_pago.pdf");
}

/* WHATSAPP COMPLETO */
function enviarWhats(){
 let nombre=document.getElementById("clienteNombre").value;
 let pago=document.getElementById("metodoPago").value;

 let msg="Hola Cuba Market, mi pedido:%0A";
 msg+="Cliente: "+nombre+"%0A";
 msg+="Pago: "+pago+"%0A%0AProductos:%0A";

 carrito.forEach(it=>{
   msg+=`${it.nombre} x${it.cantidad}%0A`;
 });

 window.open("https://wa.me/58752291?text="+msg);
}
</script>

</body>
    </html>
