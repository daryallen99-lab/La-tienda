<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>ğŸ‡¨ğŸ‡º Cuba Market - Tienda Online</title>

<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<style>
body{
    margin:0;
    font-family:Arial,sans-serif;
    background:linear-gradient(#f8f8f8,#eaeaea);
}
header{
    background:#d40000;
    color:white;
    padding:20px;
    text-align:center;
    font-size:28px;
    font-weight:bold;
}
.container{
    max-width:1200px;
    margin:auto;
    padding:20px;
}
.search{
    width:100%;
    padding:12px;
    font-size:16px;
    border-radius:10px;
    border:2px solid #ccc;
    margin-bottom:20px;
}
.products{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
    gap:15px;
}
.product{
    background:white;
    border-radius:15px;
    padding:15px;
    text-align:center;
    box-shadow:0 0 10px rgba(0,0,0,0.15);
    transition:0.2s;
}
.product:hover{
    transform:scale(1.03);
}
.product h3{
    margin:10px 0;
}
.btn{
    background:#d40000;
    color:white;
    border:none;
    padding:10px 15px;
    border-radius:10px;
    cursor:pointer;
    font-weight:bold;
}
.btn:hover{
    opacity:0.85;
}
#cartPanel{
    position:fixed;
    top:0;
    right:-450px;
    width:400px;
    height:100%;
    background:white;
    box-shadow:-5px 0 15px rgba(0,0,0,0.3);
    padding:20px;
    overflow:auto;
    transition:0.4s;
    z-index:999;
}
#cartPanel.active{
    right:0;
}
.cartItem{
    border-bottom:1px solid #ddd;
    padding:10px 0;
}
.cartItem button{
    margin:3px;
}
.totalBox{
    font-size:18px;
    margin-top:15px;
    font-weight:bold;
}
.panelCliente{
    background:white;
    padding:20px;
    margin-top:25px;
    border-radius:15px;
    box-shadow:0 0 10px rgba(0,0,0,0.15);
}
.panelCliente input,select{
    width:100%;
    padding:10px;
    margin:6px 0;
    border-radius:10px;
    border:1px solid #ccc;
}
hr{
    margin:15px 0;
}
</style>
</head>

<body>

<header>ğŸ‡¨ğŸ‡º Cuba Market - Tienda Online</header>

<div class="container">

<input class="search" id="buscador" placeholder="ğŸ” Buscar productos..." onkeyup="filtrarProductos()">

<button class="btn" onclick="toggleCarrito()">ğŸ›’ Ver Carrito</button>

<!-- PRODUCTOS -->
<div class="products" id="listaProductos"></div>

<!-- PANEL CLIENTE -->
<div class="panelCliente">
<h2>ğŸ§¾ Datos del Cliente</h2>

<input id="nombreCliente" placeholder="Nombre y Apellidos">
<input id="direccionCliente" placeholder="DirecciÃ³n">
<input id="telefonoCliente" placeholder="NÃºmero de TelÃ©fono">
<input id="ciCliente" placeholder="Carnet de Identidad">

<input id="quienRecibe" placeholder="QuiÃ©n recibe">
<input id="quienPaga" placeholder="QuiÃ©n paga">

<select id="entrega">
<option value="">Tipo de entrega</option>
<option value="Recoger en tienda">ğŸª Recoger en tienda</option>
<option value="MensajerÃ­a a domicilio">ğŸ›µ MensajerÃ­a a domicilio</option>
</select>

<hr>

<h3>ğŸŸ CupÃ³n Promocional</h3>
<input id="cuponInput" placeholder="Ej: CUBA10">
<button class="btn" onclick="aplicarCupon()">Aplicar CupÃ³n</button>
<p id="mensajeCupon"></p>

<hr>

<h3>ğŸ’³ MÃ©todo de Pago</h3>
<select id="metodoPago">
<option>CRIPTO â†’ Wallet: 0xA1B2C3</option>
<option>CUP â†’ Cuenta: 123456789</option>
<option>USD â†’ Cuenta: 998877665</option>
<option>MLC â†’ Cuenta: 556677889</option>
<option>CLÃSICA â†’ Cuenta: 111222333</option>
</select>

<hr>

<button class="btn" onclick="enviarWhatsApp()">ğŸ“² Enviar Pedido a WhatsApp</button>
<button class="btn" onclick="facturaPDF()">ğŸ“„ Descargar Factura PDF</button>
<button class="btn" onclick="comprobantePDF()">ğŸ§¾ Descargar Comprobante PDF</button>

</div>
</div>

<!-- CARRITO -->
<div id="cartPanel">
<h2>ğŸ›’ Carrito</h2>
<div id="cartItems"></div>
<div class="totalBox" id="totalCarrito"></div>

<button class="btn" onclick="toggleCarrito()">âŒ Ocultar</button>
</div>

<script>
/* PRODUCTOS */
const productos = [
 {nombre:"ğŸ— Pollo",precio:1200},
 {nombre:"ğŸš Arroz 1kg",precio:350},
 {nombre:"ğŸª Galletas",precio:250},
 {nombre:"ğŸ¬ AzÃºcar 1kg",precio:300},
 {nombre:"ğŸ›¢ Aceite 1L",precio:1500},
 {nombre:"ğŸ¥› Leche en polvo",precio:2200},
 {nombre:"ğŸ¥– Pan",precio:150},
 {nombre:"ğŸ§€ Queso",precio:1800},
 {nombre:"ğŸ¥š Huevos (10)",precio:900},
 {nombre:"ğŸ« Chocolate",precio:400},
 {nombre:"ğŸ Espaguetis",precio:500},
 {nombre:"ğŸ¥« Picadillo",precio:700},
 {nombre:"ğŸ¯ Miel",precio:950},
 {nombre:"â˜• CafÃ©",precio:1600},
 {nombre:"ğŸ¥¤ Refresco",precio:250},
 {nombre:"ğŸ Manzanas",precio:600},
 {nombre:"ğŸŒ PlÃ¡tanos",precio:300},
 {nombre:"ğŸŸ Pescado",precio:1300},
 {nombre:"ğŸ¥© Carne de cerdo",precio:2000},
 {nombre:"ğŸ“ Mermelada",precio:550}
];

let carrito = {};
let descuentoActivo = 0;

/* CUPONES */
const cuponesValidos = {
 "CUBA10":0.10,
 "MARKET10":0.10,
 "DESCUENTO10":0.10
};

/* MOSTRAR PRODUCTOS */
function renderProductos(){
 let html="";
 productos.forEach((p,i)=>{
   html+=`
   <div class="product">
     <h3>${p.nombre}</h3>
     <p><b>${p.precio} CUP</b></p>
     <button class="btn" onclick="agregarCarrito(${i})">AÃ±adir</button>
   </div>`;
 });
 document.getElementById("listaProductos").innerHTML=html;
}
renderProductos();

/* BUSCADOR */
function filtrarProductos(){
 let q=document.getElementById("buscador").value.toLowerCase();
 let cards=document.querySelectorAll(".product");
 cards.forEach(c=>{
   c.style.display=c.innerText.toLowerCase().includes(q)?"block":"none";
 });
}

/* CARRITO */
function agregarCarrito(i){
 let p=productos[i];
 if(!carrito[p.nombre]){
   carrito[p.nombre]={...p,cant:1};
 }else{
   carrito[p.nombre].cant++;
 }
 actualizarCarrito();
}

function actualizarCarrito(){
 let html="";
 let subtotal=0;
 Object.values(carrito).forEach(p=>{
   let total=p.precio*p.cant;
   subtotal+=total;
   html+=`
   <div class="cartItem">
     ${p.nombre} <br>
     Cantidad: ${p.cant} <br>
     Total: ${total} CUP <br>
     <button onclick="cambiarCantidad('${p.nombre}',1)">â•</button>
     <button onclick="cambiarCantidad('${p.nombre}',-1)">â–</button>
     <button onclick="eliminarProducto('${p.nombre}')">ğŸ—‘</button>
   </div>`;
 });

 let descuento=subtotal*descuentoActivo;
 let totalFinal=subtotal-descuento;

 document.getElementById("cartItems").innerHTML=html;
 document.getElementById("totalCarrito").innerHTML=
 `Subtotal: ${subtotal.toFixed(2)} CUP<br>
  Descuento: -${descuento.toFixed(2)} CUP<br>
  <b>Total: ${totalFinal.toFixed(2)} CUP</b>`;
}

function cambiarCantidad(nombre,delta){
 carrito[nombre].cant+=delta;
 if(carrito[nombre].cant<=0) delete carrito[nombre];
 actualizarCarrito();
}

function eliminarProducto(nombre){
 delete carrito[nombre];
 actualizarCarrito();
}

/* TOGGLE */
function toggleCarrito(){
 document.getElementById("cartPanel").classList.toggle("active");
}

/* CUPON */
function aplicarCupon(){
 let c=document.getElementById("cuponInput").value.trim().toUpperCase();
 if(cuponesValidos[c]){
   descuentoActivo=cuponesValidos[c];
   document.getElementById("mensajeCupon").innerHTML="âœ… CupÃ³n aplicado (10%)";
 }else{
   descuentoActivo=0;
   document.getElementById("mensajeCupon").innerHTML="âŒ CupÃ³n invÃ¡lido";
 }
 actualizarCarrito();
}

/* WHATSAPP */
function enviarWhatsApp(){
 let nombre=document.getElementById("nombreCliente").value;
 let direccion=document.getElementById("direccionCliente").value;

 let texto="ğŸ›’ Pedido Cuba Market\n\n";
 texto+="Cliente: "+nombre+"\n";
 texto+="DirecciÃ³n: "+direccion+"\n\n";

 Object.values(carrito).forEach(p=>{
   texto+=`${p.nombre} x${p.cant}\n`;
 });

 texto+="\nTotal a pagar: "+document.getElementById("totalCarrito").innerText;

 window.open("https://wa.me/58752291?text="+encodeURIComponent(texto));
}

/* PDF FACTURA */
function facturaPDF(){
 const { jsPDF } = window.jspdf;
 let doc=new jsPDF();
 doc.setFontSize(20);
 doc.text("ğŸ‡¨ğŸ‡º Cuba Market - Factura",20,20);

 let y=40;
 Object.values(carrito).forEach(p=>{
   doc.text(`${p.nombre} x${p.cant} = ${p.precio*p.cant} CUP`,20,y);
   y+=10;
 });

 doc.text("TOTAL: "+document.getElementById("totalCarrito").innerText,20,y+10);

 doc.save("Factura_CubaMarket.pdf");
}

/* PDF COMPROBANTE */
function comprobantePDF(){
 const { jsPDF } = window.jspdf;
 let doc=new jsPDF();
 doc.setFontSize(18);
 doc.text("ğŸ§¾ Comprobante de Pago",20,20);
 doc.text("Enviar captura + factura al WhatsApp",20,35);
 doc.text("ğŸ“² +58752291",20,50);

 doc.save("Comprobante_Pago.pdf");
}
</script>

</body>
    </html>
