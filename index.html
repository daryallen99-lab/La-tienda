<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Cuba Market - Tienda Oficial</title>

<style>
body{
    margin:0;
    font-family: Arial, sans-serif;
    background:linear-gradient(120deg,#e8ffef,#fff8c6);
    color:#222;
    text-align:center;
}
h1{
    margin:15px;
    font-size:42px;
    color:#2e7d32;
}
#totalArriba{
    font-size:22px;
    font-weight:bold;
    color:#d32f2f;
    margin-bottom:15px;
}
.productos{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(190px,1fr));
    gap:15px;
    max-width:1250px;
    margin:20px auto;
    padding:15px;
}
.card{
    background:white;
    border-radius:18px;
    padding:15px;
    box-shadow:0 0 12px rgba(0,0,0,0.2);
    transition:0.2s;
}
.card:hover{
    transform:scale(1.05);
}
.card button{
    margin-top:10px;
    padding:10px 15px;
    border:none;
    border-radius:12px;
    cursor:pointer;
    background:#43a047;
    color:white;
    font-weight:bold;
}
.toggleBtn{
    background:#1976d2;
    color:white;
    padding:12px 20px;
    border:none;
    border-radius:14px;
    cursor:pointer;
    margin:10px;
    font-weight:bold;
}
details{
    max-width:750px;
    margin:15px auto;
    text-align:left;
    background:white;
    border-radius:15px;
    padding:12px;
    box-shadow:0 0 10px rgba(0,0,0,0.2);
}
summary{
    font-size:18px;
    font-weight:bold;
    cursor:pointer;
}
input,select{
    width:95%;
    padding:8px;
    margin:5px 0;
    border-radius:10px;
    border:1px solid #aaa;
}
.panel{
    position:fixed;
    top:0;
    width:360px;
    height:100%;
    background:white;
    box-shadow:0 0 15px rgba(0,0,0,0.3);
    padding:15px;
    overflow:auto;
    display:none;
    z-index:999;
}
#carritoPanel{ right:0; }
#walletPanel{ left:0; }

.itemCarrito{
    border-bottom:1px solid #ddd;
    padding:10px;
}
.itemCarrito button{
    margin:3px;
    padding:5px 10px;
    border:none;
    border-radius:8px;
    cursor:pointer;
}
.btnMas{background:#2e7d32;color:white;}
.btnMenos{background:#ff9800;color:white;}
.btnEliminar{background:#d32f2f;color:white;}

.btnFactura{background:#2e7d32;color:white;padding:10px;border:none;border-radius:12px;margin:5px;}
.btnWhats{background:#25d366;color:white;padding:10px;border:none;border-radius:12px;margin:5px;}
.btnComp{background:#1976d2;color:white;padding:10px;border:none;border-radius:12px;margin:5px;}
.btnRecarga{background:#ff9800;color:white;padding:10px;border:none;border-radius:12px;margin:5px;}
</style>
</head>

<body>

<h1>üõí CUBA MARKET üõí</h1>

<div id="totalArriba">TOTAL ACTUAL: 0 CUP</div>

<button class="toggleBtn" onclick="mostrarCarrito()">üõç Carrito</button>
<button class="toggleBtn" onclick="mostrarWallet()">üëõ Billetera</button>

<input type="text" id="buscador" placeholder="üîç Buscar productos..." onkeyup="filtrarProductos()">

<div class="productos" id="listaProductos"></div>

<!-- CLIENTE -->
<details>
<summary>üìå Datos del Cliente</summary>
<input id="clienteNombre" placeholder="Nombre y Apellidos">
<input id="clienteDireccion" placeholder="Direcci√≥n">
<input id="clienteTelefono" placeholder="Tel√©fono">
<input id="clienteCI" placeholder="Carnet de Identidad">
<input id="quienRecibe" placeholder="Qui√©n recibe">
<input id="quienPaga" placeholder="Qui√©n paga">

<select id="entrega">
<option>Recoger en tienda</option>
<option>Mensajer√≠a</option>
</select>
</details>

<!-- PAGO -->
<details>
<summary>üí≥ Seleccionar M√©todo de Pago</summary>
<select id="metodoPago">
<option value="">-- Elegir m√©todo --</option>
<option>CRIPTO (928374)</option>
<option>CUP (837261)</option>
<option>USD (112233)</option>
<option>MLC (445566)</option>
<option>CL√ÅSICA (778899)</option>
</select>
</details>

<!-- CUP√ìN -->
<details>
<summary>üéÅ Cup√≥n Promocional</summary>
<input id="cupon" placeholder="C√≥digo promocional (TIENDA10)">
<button onclick="aplicarCupon()">Aplicar descuento</button>
<p id="estadoCupon"></p>
</details>

<!-- CARRITO -->
<div class="panel" id="carritoPanel">
<h2>üõí Tu Carrito</h2>
<div id="carritoItems"></div>

<h3 id="subtotalCarrito"></h3>
<h3 id="descuentoCarrito"></h3>
<h2 id="totalCarrito"></h2>

<button class="btnFactura" onclick="generarFactura()">üìÑ Factura PDF</button>
<button class="btnComp" onclick="generarComprobante()">üßæ Comprobante PDF</button>
<button class="btnWhats" onclick="enviarWhats()">üì≤ Enviar WhatsApp</button>
<button onclick="ocultarCarrito()">‚ùå Cerrar</button>
</div>

<!-- WALLET -->
<div class="panel" id="walletPanel">
<h2>üëõ Billetera Cuba Market</h2>
<h1 id="saldoWallet">0 CUP</h1>

<input id="montoRecarga" placeholder="Monto a recargar manualmente">

<select id="metodoRecarga">
<option value="">-- M√©todo de recarga --</option>
<option>CRIPTO (928374)</option>
<option>CUP (837261)</option>
<option>USD (112233)</option>
<option>MLC (445566)</option>
</select>

<button class="btnRecarga" onclick="recargarSaldo()">üì≤ Solicitar recarga</button>
<p id="estadoRecarga"></p>

<button onclick="ocultarWallet()">‚ùå Cerrar</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
let productos=[
 {nombre:"üçó Pollo entero",precio:2200},
 {nombre:"üçö Arroz 1kg",precio:750},
 {nombre:"ü•ö Huevos 30 uds",precio:3000},
 {nombre:"üõ¢ Aceite 1L",precio:1400},
 {nombre:"üç¨ Az√∫car 1kg",precio:300},
 {nombre:"‚òï Caf√© 250g",precio:2200},
 {nombre:"ü´ò Frijoles 1lb",precio:500},
 {nombre:"ü•© Carne de cerdo 1kg",precio:1300},
 {nombre:"üêÑ Carne de res 1kg",precio:1800},
 {nombre:"üßÄ Queso 1kg",precio:2600},
 {nombre:"üçØ Miel 500g",precio:1500},
 {nombre:"üçù Pasta 500g",precio:400},
 {nombre:"ü•´ At√∫n lata",precio:1200},
 {nombre:"üç™ Galletas surtidas",precio:800},
 {nombre:"ü•õ Leche en polvo",precio:2500},
 {nombre:"ü•§ Refresco 1L",precio:450},
 {nombre:"ü•¨ Lechuga",precio:220},
 {nombre:"üçÖ Tomate 1kg",precio:800},
 {nombre:"ü•î Papa 1kg",precio:450},
 {nombre:"üçå Pl√°tano fruta",precio:250},

 /* +30 EXTRA */
 {nombre:"ü•ì Jam√≥n 1kg",precio:2800},
 {nombre:"üå≠ Salchichas",precio:1500},
 {nombre:"üçû Pan suave",precio:300},
 {nombre:"üßà Mantequilla",precio:2000},
 {nombre:"üç´ Chocolate",precio:900},
 {nombre:"ü•´ Mayonesa",precio:1600},
 {nombre:"üçØ Dulce de guayaba",precio:1100},
 {nombre:"üßÉ Jugo en caja",precio:800},
 {nombre:"üßÇ Sal 1kg",precio:250},
 {nombre:"üçö Harina de ma√≠z",precio:700},
 {nombre:"üçò Snacks",precio:600},
 {nombre:"üçé Manzana 1kg",precio:2200},
 {nombre:"üçá Uvas",precio:3000},
 {nombre:"ü•• Coco",precio:500},
 {nombre:"üçç Pi√±a",precio:800},
 {nombre:"üçâ Sand√≠a",precio:1200},
 {nombre:"ü•ï Zanahoria",precio:550},
 {nombre:"üßÖ Cebolla",precio:600},
 {nombre:"üßÑ Ajo",precio:400},
 {nombre:"üßº Jab√≥n",precio:700},
 {nombre:"üß¥ Shampoo",precio:2500},
 {nombre:"üßª Papel sanitario",precio:1800},
 {nombre:"üßΩ Detergente",precio:1500},
 {nombre:"ü™• Pasta dental",precio:1200},
 {nombre:"üß∫ Suavizante",precio:2000},
 {nombre:"üçó Muslos pollo",precio:2400},
 {nombre:"ü•© Picadillo",precio:1900},
 {nombre:"üçü Papas fritas",precio:900},
 {nombre:"ü•£ Yogurt",precio:1000},
 {nombre:"üç∞ Cake peque√±o",precio:2500}
];

let carrito=[];
let descuento=0;
let codigoAplicado="";

/* MOSTRAR PRODUCTOS */
function cargarProductos(lista=productos){
 let cont=document.getElementById("listaProductos");
 cont.innerHTML="";
 lista.forEach((p)=>{
   let existe=carrito.find(x=>x.nombre==p.nombre);
   let cantidad=existe ? existe.cantidad : 0;

   cont.innerHTML+=`
   <div class="card">
    <h3>${p.nombre}</h3>
    <p>${p.precio} CUP</p>
    <button onclick="agregarCarrito('${p.nombre}')">
      A√±adir ${cantidad>0 ? "(x"+cantidad+")" : ""}
    </button>
   </div>`;
 });
}
cargarProductos();

/* FILTRAR */
function filtrarProductos(){
 let texto=document.getElementById("buscador").value.toLowerCase();
 let filtrados=productos.filter(p=>p.nombre.toLowerCase().includes(texto));
 cargarProductos(filtrados);
}

/* AGREGAR */
function agregarCarrito(nombre){
 let prod=productos.find(p=>p.nombre==nombre);
 let existe=carrito.find(x=>x.nombre==nombre);

 if(existe) existe.cantidad++;
 else carrito.push({nombre:prod.nombre,precio:prod.precio,cantidad:1});

 actualizarCarrito();
}

/* ACTUALIZAR */
function actualizarCarrito(){
 let div=document.getElementById("carritoItems");
 div.innerHTML="";
 let subtotal=0;

 carrito.forEach((it,index)=>{
   subtotal+=it.precio*it.cantidad;

   div.innerHTML+=`
   <div class="itemCarrito">
    ${it.nombre} x${it.cantidad} = ${it.precio*it.cantidad} CUP
    <br>
    <button class="btnMas" onclick="cambiarCantidad(${index},1)">+</button>
    <button class="btnMenos" onclick="cambiarCantidad(${index},-1)">-</button>
    <button class="btnEliminar" onclick="eliminarProducto(${index})">X</button>
   </div>`;
 });

 let montoDescuento=subtotal*descuento;
 let total=subtotal-montoDescuento;

 document.getElementById("subtotalCarrito").innerText="Subtotal: "+subtotal+" CUP";

 document.getElementById("descuentoCarrito").innerText=
 descuento>0 ? `Descuento 10% (${codigoAplicado}): -${montoDescuento.toFixed(2)} CUP` : "";

 document.getElementById("totalCarrito").innerText="TOTAL: "+total.toFixed(2)+" CUP";
 document.getElementById("totalArriba").innerText="TOTAL ACTUAL: "+total.toFixed(2)+" CUP";

 cargarProductos();
}

/* CAMBIAR */
function cambiarCantidad(index,valor){
 carrito[index].cantidad+=valor;
 if(carrito[index].cantidad<=0) carrito.splice(index,1);
 actualizarCarrito();
}

/* ELIMINAR */
function eliminarProducto(index){
 carrito.splice(index,1);
 actualizarCarrito();
}

/* CUP√ìN */
function aplicarCupon(){
 let c=document.getElementById("cupon").value.trim();
 if(c=="TIENDA10"){
   descuento=0.10;
   codigoAplicado=c;
   document.getElementById("estadoCupon").innerText="‚úÖ Cup√≥n aplicado";
 }else{
   descuento=0;
   codigoAplicado="";
   document.getElementById("estadoCupon").innerText="‚ùå Cup√≥n inv√°lido";
 }
 actualizarCarrito();
}

/* PANEL */
function mostrarCarrito(){document.getElementById("carritoPanel").style.display="block";}
function ocultarCarrito(){document.getElementById("carritoPanel").style.display="none";}
function mostrarWallet(){document.getElementById("walletPanel").style.display="block";}
function ocultarWallet(){document.getElementById("walletPanel").style.display="none";}

/* PDF FACTURA PRO */
function generarFactura(){
 const {jsPDF}=window.jspdf;
 let doc=new jsPDF();

 let nombre=document.getElementById("clienteNombre").value;
 let direccion=document.getElementById("clienteDireccion").value;
 let telefono=document.getElementById("clienteTelefono").value;
 let ci=document.getElementById("clienteCI").value;
 let entrega=document.getElementById("entrega").value;
 let pago=document.getElementById("metodoPago").value;

 doc.setFontSize(18);
 doc.text("Factura - Cuba Market",20,20);

 doc.setFontSize(12);
 doc.text("Cliente: "+nombre,20,35);
 doc.text("Direcci√≥n: "+direccion,20,42);
 doc.text("Tel√©fono: "+telefono,20,49);
 doc.text("CI: "+ci,20,56);
 doc.text("Entrega: "+entrega,20,63);
 doc.text("Pago: "+pago,20,70);

 let y=85;
 let subtotal=0;

 carrito.forEach(it=>{
   doc.text(`${it.nombre.replace(/[^a-zA-Z0-9 ]/g,"")} x${it.cantidad}`,20,y);
   subtotal+=it.precio*it.cantidad;
   y+=8;
 });

 let montoDesc=subtotal*descuento;
 let total=subtotal-montoDesc;

 y+=10;
 doc.text("Subtotal: "+subtotal+" CUP",20,y);
 if(descuento>0){
   doc.text(`Descuento 10% (${codigoAplicado}): -${montoDesc.toFixed(2)} CUP`,20,y+8);
 }
 doc.text("TOTAL FINAL: "+total.toFixed(2)+" CUP",20,y+18);

 doc.text("Gracias por su compra ‚ù§Ô∏è",20,y+35);

 doc.save("factura_cubamarket.pdf");
}

/* PDF COMPROBANTE */
function generarComprobante(){
 const {jsPDF}=window.jspdf;
 let doc=new jsPDF();
 doc.setFontSize(16);
 doc.text("Comprobante de Pago - Cuba Market",20,20);
 doc.setFontSize(12);
 doc.text("Enviar factura + captura del pago por WhatsApp.",20,40);
 doc.text("Gracias por confiar en nosotros.",20,55);
 doc.save("comprobante_pago.pdf");
}

/* WHATSAPP PRO */
function enviarWhats(){
 let nombre=document.getElementById("clienteNombre").value;
 let entrega=document.getElementById("entrega").value;
 let pago=document.getElementById("metodoPago").value;

 let msg=`Hola Cuba Market, soy ${nombre}.%0A%0AMi pedido es:%0A`;

 carrito.forEach(it=>{
   msg+=`${it.nombre} x${it.cantidad}%0A`;
 });

 msg+=`%0AEntrega: ${entrega}%0APago: ${pago}%0A`;

 window.open("https://wa.me/58752291?text="+msg);
}

/* RECARGA WALLET */
function recargarSaldo(){
 let monto=document.getElementById("montoRecarga").value;
 let metodo=document.getElementById("metodoRecarga").value;

 if(monto=="" || metodo==""){
   document.getElementById("estadoRecarga").innerText="‚ùå Completa monto y m√©todo.";
   return;
 }

 let msg=`Hola Cuba Market, quiero recargar saldo.%0AMonto: ${monto} CUP%0AM√©todo: ${metodo}`;
 window.open("https://wa.me/58752291?text="+msg);

 document.getElementById("estadoRecarga").innerText="‚úÖ Solicitud enviada por WhatsApp.";
}
</script>

</body>
    </html>
