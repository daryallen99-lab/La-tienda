<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Cuba Market ğŸ›’</title>

<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<style>
body{
    margin:0;
    font-family: Arial;
    background: radial-gradient(circle,#111,#000);
    color:white;
    text-align:center;
}
h1{
    font-size:42px;
    margin:20px;
    color:#00ffcc;
    text-shadow:0 0 15px #00ffcc;
}
.container{
    max-width:1100px;
    margin:auto;
    padding:20px;
}
.search{
    width:80%;
    padding:12px;
    border-radius:12px;
    border:none;
    font-size:18px;
    margin-bottom:20px;
}
.grid{
    display:grid;
    grid-template-columns: repeat(auto-fit,minmax(200px,1fr));
    gap:15px;
}
.product{
    background:#111;
    border:2px solid #00ffcc;
    padding:15px;
    border-radius:15px;
    box-shadow:0 0 15px #00ffcc;
    transition:0.3s;
}
.product:hover{
    transform:scale(1.05);
}
.product button{
    margin-top:10px;
    padding:10px;
    border:none;
    border-radius:10px;
    cursor:pointer;
    background:#00ffcc;
    font-weight:bold;
}
#cartPanel{
    display:none;
    background:#000;
    border:2px solid yellow;
    border-radius:15px;
    padding:20px;
    margin-top:20px;
    box-shadow:0 0 20px yellow;
}
.cartItem{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin:8px 0;
    padding:8px;
    border-bottom:1px solid #333;
}
.cartItem button{
    margin:0 3px;
    padding:5px 10px;
    border:none;
    border-radius:8px;
    cursor:pointer;
    font-weight:bold;
}
.btnPlus{background:lime;}
.btnMinus{background:orange;}
.btnDel{background:red;color:white;}

button.mainBtn{
    padding:15px 25px;
    margin:10px;
    font-size:18px;
    border:none;
    border-radius:12px;
    cursor:pointer;
    background:#00ffcc;
    font-weight:bold;
    box-shadow:0 0 12px #00ffcc;
}
.infoBox{
    background:#111;
    padding:20px;
    margin-top:25px;
    border-radius:15px;
    border:2px solid magenta;
    box-shadow:0 0 15px magenta;
}
input,select{
    width:90%;
    padding:10px;
    margin:6px;
    border-radius:10px;
    border:none;
    font-size:16px;
}
</style>
</head>

<body>

<h1>ğŸ›’ Cuba Market ğŸ‡¨ğŸ‡º</h1>

<div class="container">

<input class="search" id="buscador" placeholder="ğŸ” Buscar productos..." onkeyup="filtrarProductos()">

<!-- PRODUCTOS -->
<div class="grid" id="productos"></div>

<!-- BOTONES -->
<button class="mainBtn" onclick="toggleCarrito()">ğŸ› Ver / Ocultar Carrito</button>
<button class="mainBtn" onclick="enviarWhatsApp()">ğŸ“² Enviar pedido por WhatsApp</button>
<button class="mainBtn" onclick="facturaPDF()">ğŸ§¾ Generar Factura PDF</button>

<!-- CARRITO -->
<div id="cartPanel">
    <h2>ğŸ›’ Carrito</h2>
    <div id="cartItems"></div>
    <h3 id="total"></h3>
</div>

<!-- DATOS CLIENTE -->
<div class="infoBox">
<h2>ğŸ“Œ Datos del Cliente</h2>

<input id="nombreCliente" placeholder="Nombre y Apellidos">
<input id="direccionCliente" placeholder="DirecciÃ³n">
<input id="telefonoCliente" placeholder="NÃºmero de telÃ©fono">
<input id="ciCliente" placeholder="Carnet de identidad">
<input id="quienRecibe" placeholder="QuiÃ©n recibe">
<input id="quienPaga" placeholder="QuiÃ©n paga">

<select id="entrega">
<option>Recoger en tienda</option>
<option>MensajerÃ­a</option>
</select>

<h3>ğŸŸ CupÃ³n promocional</h3>
<input id="promoCode" placeholder="Ejemplo: CUBA10">
<button class="mainBtn" onclick="aplicarPromo()">Aplicar cupÃ³n</button>

<h3>ğŸ’³ MÃ©todo de pago</h3>
<select id="metodoPago">
<option>CRIPTO - Cuenta: 8XH92K</option>
<option>CUP - Cuenta: 920183</option>
<option>USD - Cuenta: 772910</option>
<option>MLC - Cuenta: 551992</option>
<option>CLÃSICA - Cuenta: 000777</option>
</select>

<p style="color:yellow;">
ğŸ“Œ Para validar tu compra debes enviar la factura + captura del pago al WhatsApp.
</p>

</div>

</div>

<script>
/* =============================
   PRODUCTOS (20+)
============================= */
let listaProductos = [
 {nombre:"ğŸ— Pollo",precio:3200},
 {nombre:"ğŸš Arroz (1kg)",precio:250},
 {nombre:"ğŸª Galletas",precio:180},
 {nombre:"ğŸ›¢ Aceite (1L)",precio:1500},
 {nombre:"ğŸ¬ AzÃºcar (1kg)",precio:300},
 {nombre:"ğŸ¥› Leche en polvo",precio:2800},
 {nombre:"ğŸ¥š Huevos (30)",precio:2500},
 {nombre:"ğŸ¥– Pan",precio:120},
 {nombre:"ğŸ§€ Queso",precio:2200},
 {nombre:"ğŸ Pasta",precio:350},
 {nombre:"ğŸŒ­ Salchichas",precio:900},
 {nombre:"ğŸ¥« Picadillo",precio:650},
 {nombre:"ğŸ« Chocolate",precio:500},
 {nombre:"ğŸ¯ Miel",precio:1300},
 {nombre:"ğŸ Manzanas",precio:1200},
 {nombre:"ğŸŒ PlÃ¡tanos",precio:600},
 {nombre:"ğŸ¥¤ Refresco",precio:400},
 {nombre:"â˜• CafÃ©",precio:2000},
 {nombre:"ğŸ§‚ Sal",precio:150},
 {nombre:"ğŸ§ˆ Mantequilla",precio:2100}
];

let carrito = {};
let descuentoActivo = 0;

/* =============================
   MOSTRAR PRODUCTOS
============================= */
function cargarProductos(){
  let div = document.getElementById("productos");
  div.innerHTML="";
  listaProductos.forEach((p,i)=>{
    div.innerHTML += `
      <div class="product">
        <h2>${p.nombre}</h2>
        <p><b>${p.precio} CUP</b></p>
        <button onclick="agregarCarrito(${i})">â• AÃ±adir</button>
      </div>
    `;
  });
}
cargarProductos();

/* =============================
   FILTRAR PRODUCTOS
============================= */
function filtrarProductos(){
  let texto = document.getElementById("buscador").value.toLowerCase();
  let div = document.getElementById("productos");
  div.innerHTML="";

  listaProductos.filter(p=>p.nombre.toLowerCase().includes(texto))
  .forEach((p,i)=>{
    div.innerHTML += `
      <div class="product">
        <h2>${p.nombre}</h2>
        <p><b>${p.precio} CUP</b></p>
        <button onclick="agregarCarrito(${i})">â• AÃ±adir</button>
      </div>
    `;
  });
}

/* =============================
   CARRITO FUNCIONES
============================= */
function agregarCarrito(i){
  let p = listaProductos[i];
  if(!carrito[p.nombre]){
    carrito[p.nombre]={...p,cant:1};
  } else {
    carrito[p.nombre].cant++;
  }
  renderCarrito();
}

function cambiarCantidad(nombre,delta){
  carrito[nombre].cant += delta;
  if(carrito[nombre].cant<=0) delete carrito[nombre];
  renderCarrito();
}

function eliminarProducto(nombre){
  delete carrito[nombre];
  renderCarrito();
}

function renderCarrito(){
  let div = document.getElementById("cartItems");
  div.innerHTML="";
  let subtotal=0;

  Object.values(carrito).forEach(p=>{
    let totalProd=p.precio*p.cant;
    subtotal += totalProd;

    div.innerHTML += `
      <div class="cartItem">
        ${p.nombre} (${p.cant})
        <div>
          <button class="btnPlus" onclick="cambiarCantidad('${p.nombre}',1)">+</button>
          <button class="btnMinus" onclick="cambiarCantidad('${p.nombre}',-1)">-</button>
          <button class="btnDel" onclick="eliminarProducto('${p.nombre}')">X</button>
        </div>
      </div>
    `;
  });

  let descuento=subtotal*descuentoActivo;
  let total=subtotal-descuento;

  document.getElementById("total").innerText=
    `Subtotal: ${subtotal.toFixed(2)} CUP | Descuento: ${descuento.toFixed(2)} CUP | TOTAL: ${total.toFixed(2)} CUP`;
}

/* =============================
   MOSTRAR / OCULTAR
============================= */
function toggleCarrito(){
  let panel=document.getElementById("cartPanel");
  panel.style.display = panel.style.display==="none"?"block":"none";
}

/* =============================
   CUPÃ“N PROMO
============================= */
function aplicarPromo(){
  let code=document.getElementById("promoCode").value.trim().toUpperCase();
  if(code==="CUBA10"){
    descuentoActivo=0.10;
    alert("âœ… CupÃ³n aplicado: 10% descuento");
  } else {
    descuentoActivo=0;
    alert("âŒ CupÃ³n invÃ¡lido");
  }
  renderCarrito();
}

/* =============================
   WHATSAPP
============================= */
function enviarWhatsApp(){
  let subtotal=0;
  let lista="";

  Object.values(carrito).forEach(p=>{
    subtotal += p.precio*p.cant;
    lista += `${p.nombre} x${p.cant}%0A`;
  });

  let descuento=subtotal*descuentoActivo;
  let total=subtotal-descuento;

  let msg=`Hola! Quiero comprar:%0A%0A${lista}%0ATotal: ${total.toFixed(2)} CUP`;

  window.open("https://wa.me/58752291?text="+msg);
}

/* =============================
   FACTURA PDF PROFESIONAL
============================= */
function facturaPDF(){
  const { jsPDF } = window.jspdf;
  let doc = new jsPDF();

  let nombre=document.getElementById("nombreCliente").value;
  let direccion=document.getElementById("direccionCliente").value;
  let telefono=document.getElementById("telefonoCliente").value;
  let ci=document.getElementById("ciCliente").value;
  let entrega=document.getElementById("entrega").value;
  let promo=document.getElementById("promoCode").value.toUpperCase();

  doc.setFont("helvetica","bold");
  doc.setFontSize(20);
  doc.text("CUBA MARKET",75,18);

  doc.setFontSize(12);
  doc.text("Factura Oficial",80,28);

  doc.line(15,32,195,32);

  let y=45;
  doc.setFont("helvetica","normal");
  doc.text("Cliente: "+nombre,15,y);
  y+=7;
  doc.text("DirecciÃ³n: "+direccion,15,y);
  y+=7;
  doc.text("TelÃ©fono: "+telefono,15,y);
  y+=7;
  doc.text("CI: "+ci,15,y);
  y+=7;
  doc.text("Entrega: "+entrega,15,y);

  y+=12;
  doc.line(15,y,195,y);
  y+=10;

  let subtotal=0;
  Object.values(carrito).forEach(p=>{
    let total=p.precio*p.cant;
    subtotal+=total;
    doc.text(`${p.nombre} x${p.cant}`,15,y);
    doc.text(`${total.toFixed(2)} CUP`,150,y);
    y+=8;
  });

  let descuento=subtotal*descuentoActivo;
  let totalFinal=subtotal-descuento;

  y+=8;
  doc.line(15,y,195,y);
  y+=10;

  doc.setFont("helvetica","bold");
  doc.text("Subtotal: "+subtotal.toFixed(2)+" CUP",120,y);

  if(descuentoActivo>0){
    y+=8;
    doc.text(`Descuento 10% (${promo}): -${descuento.toFixed(2)} CUP`,15,y);
  }

  y+=10;
  doc.setFontSize(14);
  doc.text("TOTAL: "+totalFinal.toFixed(2)+" CUP",120,y);

  y+=18;
  doc.setFontSize(11);
  doc.setFont("helvetica","normal");
  doc.text("Gracias por tu compra en Cuba Market ğŸ‡¨ğŸ‡ºâœ¨",50,y);

  y+=10;
  doc.text("EnvÃ­a esta factura + captura del pago al WhatsApp:",15,y);
  y+=7;
  doc.setFont("helvetica","bold");
  doc.text("ğŸ“² +5875 22 91",15,y);

  let blob=doc.output("blob");
  let url=URL.createObjectURL(blob);
  window.open(url,"_blank");
}
</script>

</body>
    </html>
