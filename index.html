<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Cuba Market - Tienda Oficial</title>

<style>
body{
    margin:0;
    font-family: Arial, sans-serif;
    background:linear-gradient(120deg,#eaffd0,#fff9c4);
    color:#222;
    text-align:center;
}

h1{
    margin:20px;
    font-size:42px;
    color:#2e7d32;
}

.productos{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
    gap:15px;
    max-width:1100px;
    margin:20px auto;
    padding:15px;
}

.card{
    background:white;
    border-radius:18px;
    padding:15px;
    box-shadow:0 0 12px rgba(0,0,0,0.2);
}

.card button{
    margin-top:10px;
    padding:10px 15px;
    border:none;
    border-radius:12px;
    cursor:pointer;
    background:#43a047;
    color:white;
    font-weight:bold;
}

.toggleBtn{
    background:#1976d2;
    color:white;
    padding:12px 20px;
    border:none;
    border-radius:14px;
    cursor:pointer;
    margin:10px;
    font-weight:bold;
}

details{
    max-width:700px;
    margin:15px auto;
    text-align:left;
    background:white;
    border-radius:15px;
    padding:12px;
    box-shadow:0 0 10px rgba(0,0,0,0.2);
}

summary{
    font-size:18px;
    font-weight:bold;
    cursor:pointer;
}

input,select{
    width:95%;
    padding:8px;
    margin:5px 0;
    border-radius:10px;
    border:1px solid #aaa;
}

/* PANEL CARRITO */
.panel{
    position:fixed;
    top:0;
    width:330px;
    height:100%;
    background:white;
    box-shadow:0 0 15px rgba(0,0,0,0.3);
    padding:15px;
    overflow:auto;
    display:none;
    z-index:999;
}

#carritoPanel{ right:0; }
#walletPanel{ left:0; }

.itemCarrito{
    border-bottom:1px solid #ddd;
    padding:10px;
}

.itemCarrito button{
    margin:3px;
    padding:5px 10px;
    border:none;
    border-radius:8px;
    cursor:pointer;
}

.btnMas{background:#2e7d32;color:white;}
.btnMenos{background:#ff9800;color:white;}
.btnEliminar{background:#d32f2f;color:white;}

.btnFactura{background:#2e7d32;color:white;}
.btnWhats{background:#25d366;color:white;}
.btnRecarga{background:#ff9800;color:white;}
</style>
</head>

<body>

<h1>ğŸ›’ CUBA MARKET ğŸ›’</h1>

<button class="toggleBtn" onclick="mostrarCarrito()">ğŸ› Carrito</button>
<button class="toggleBtn" onclick="mostrarWallet()">ğŸ‘› Billetera</button>

<input type="text" id="buscador" placeholder="ğŸ” Buscar productos..." onkeyup="filtrarProductos()">

<!-- PRODUCTOS -->
<div class="productos" id="listaProductos"></div>

<!-- DATOS CLIENTE -->
<details>
<summary>ğŸ“Œ Datos del Cliente</summary>
<input id="clienteNombre" placeholder="Nombre y Apellidos">
<input id="clienteDireccion" placeholder="DirecciÃ³n">
<input id="clienteTelefono" placeholder="TelÃ©fono">
<input id="clienteCI" placeholder="Carnet de Identidad">

<select id="entrega">
<option>Recoger en tienda</option>
<option>MensajerÃ­a</option>
</select>
</details>

<!-- MÃ‰TODO DE PAGO -->
<details>
<summary>ğŸ’³ Seleccionar MÃ©todo de Pago</summary>

<select id="metodoPago">
<option value="">-- Elegir mÃ©todo --</option>
<option value="CRIPTO">CRIPTO (928374)</option>
<option value="CUP">CUP (837261)</option>
<option value="USD">USD (112233)</option>
<option value="MLC">MLC (445566)</option>
<option value="CLÃSICA">CLÃSICA (778899)</option>
</select>

</details>

<!-- CUPÃ“N -->
<details>
<summary>ğŸ CupÃ³n Promocional</summary>
<input id="cupon" placeholder="CÃ³digo promocional (PROMO10)">
<button onclick="aplicarCupon()">Aplicar descuento</button>
<p id="estadoCupon"></p>
</details>

<!-- PANEL CARRITO -->
<div class="panel" id="carritoPanel">
<h2>ğŸ›’ Tu Carrito</h2>
<div id="carritoItems"></div>

<h3 id="subtotalCarrito"></h3>
<h3 id="descuentoCarrito"></h3>
<h2 id="totalCarrito"></h2>

<button class="btnFactura" onclick="generarFactura()">ğŸ“„ Factura PDF</button>
<button class="btnWhats" onclick="enviarWhats()">ğŸ“² WhatsApp</button>
<button onclick="ocultarCarrito()">âŒ Cerrar</button>
</div>

<!-- PANEL BILLETERA -->
<div class="panel" id="walletPanel">
<h2>ğŸ‘› Billetera Cuba Market</h2>

<h3>Saldo actual:</h3>
<h1 id="saldoWallet">0 CUP</h1>

<button class="btnRecarga" onclick="recargarSaldo()">â• Agregar saldo</button>

<p id="estadoRecarga"></p>

<button onclick="ocultarWallet()">âŒ Cerrar</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
let productos=[
 {nombre:"ğŸ— Pollo",precio:3200},
 {nombre:"ğŸš Arroz 1kg",precio:250},
 {nombre:"ğŸª Galletas",precio:180},
 {nombre:"â˜• CafÃ©",precio:2000},
 {nombre:"ğŸ¯ Miel",precio:1300},
 {nombre:"ğŸ§€ Queso",precio:2200}
];

let carrito=[];
let descuento=0;
let codigoAplicado="";
let saldo=0;

function cargarProductos(){
 let cont=document.getElementById("listaProductos");
 cont.innerHTML="";
 productos.forEach((p,i)=>{
   cont.innerHTML+=`
   <div class="card producto">
    <h3>${p.nombre}</h3>
    <p>${p.precio} CUP</p>
    <button onclick="agregarCarrito(${i})">AÃ±adir</button>
   </div>`;
 });
}
cargarProductos();

function agregarCarrito(i){
 let prod=productos[i];
 let existe=carrito.find(x=>x.nombre==prod.nombre);
 if(existe) existe.cantidad++;
 else carrito.push({nombre:prod.nombre,precio:prod.precio,cantidad:1});
 actualizarCarrito();
}

function actualizarCarrito(){
 let div=document.getElementById("carritoItems");
 div.innerHTML="";
 let subtotal=0;

 carrito.forEach((it,index)=>{
   subtotal+=it.precio*it.cantidad;
   div.innerHTML+=`
   <div class="itemCarrito">
    ${it.nombre} x${it.cantidad} - ${it.precio*it.cantidad} CUP
    <br>
    <button class="btnMas" onclick="it.cantidad++;actualizarCarrito()">+</button>
    <button class="btnMenos" onclick="if(it.cantidad>1){it.cantidad--;actualizarCarrito()}">-</button>
    <button class="btnEliminar" onclick="carrito.splice(${index},1);actualizarCarrito()">X</button>
   </div>`;
 });

 let montoDescuento=subtotal*descuento;
 let total=subtotal-montoDescuento;

 document.getElementById("subtotalCarrito").innerText="Subtotal: "+subtotal+" CUP";
 document.getElementById("descuentoCarrito").innerText=
 descuento>0 ? `Descuento 10% (${codigoAplicado}) : -${montoDescuento.toFixed(2)} CUP` : "";

 document.getElementById("totalCarrito").innerText="TOTAL: "+total.toFixed(2)+" CUP";
}

function aplicarCupon(){
 let c=document.getElementById("cupon").value.trim();
 if(c=="PROMO10"){
   descuento=0.10;
   codigoAplicado=c;
   document.getElementById("estadoCupon").innerText="âœ… CupÃ³n aplicado: 10%";
 }else{
   descuento=0;
   codigoAplicado="";
   document.getElementById("estadoCupon").innerText="âŒ CupÃ³n invÃ¡lido";
 }
 actualizarCarrito();
}

/* PANEL CONTROL */
function mostrarCarrito(){document.getElementById("carritoPanel").style.display="block";}
function ocultarCarrito(){document.getElementById("carritoPanel").style.display="none";}

function mostrarWallet(){document.getElementById("walletPanel").style.display="block";}
function ocultarWallet(){document.getElementById("walletPanel").style.display="none";}

/* FACTURA PDF */
function generarFactura(){
 const {jsPDF}=window.jspdf;
 let pdf=new jsPDF();
 pdf.setFont("helvetica");

 let nombre=document.getElementById("clienteNombre").value;
 let entrega=document.getElementById("entrega").value;
 let pago=document.getElementById("metodoPago").value;

 pdf.text("CUBA MARKET - FACTURA OFICIAL",20,20);
 pdf.text("Cliente: "+nombre,20,35);
 pdf.text("Entrega: "+entrega,20,45);
 pdf.text("Pago: "+pago,20,55);

 let y=75;
 let subtotal=0;

 carrito.forEach(it=>{
   subtotal+=it.precio*it.cantidad;
   pdf.text(`${it.nombre} x${it.cantidad}`,20,y);
   pdf.text(`${it.precio*it.cantidad} CUP`,150,y);
   y+=10;
 });

 let montoDesc=subtotal*descuento;
 let total=subtotal-montoDesc;

 pdf.text("Subtotal: "+subtotal+" CUP",20,y+15);

 if(descuento>0){
 pdf.text(`Descuento 10% (${codigoAplicado}): -${montoDesc.toFixed(2)} CUP`,20,y+25);
 }

 pdf.text("TOTAL FINAL: "+total.toFixed(2)+" CUP",20,y+40);
 pdf.text("Gracias por tu compra â¤ï¸",20,y+60);

 pdf.save("factura.pdf");
}

/* WHATSAPP */
function enviarWhats(){
 let nombre=document.getElementById("clienteNombre").value;
 let entrega=document.getElementById("entrega").value;
 let pago=document.getElementById("metodoPago").value;

 let msg=`Hola, quiero hacer este pedido en Cuba Market:%0A%0A`;
 msg+=`Cliente: ${nombre}%0AEntrega: ${entrega}%0APago: ${pago}%0A%0A`;

 carrito.forEach(it=>{
   msg+=`${it.nombre} x${it.cantidad}%0A`;
 });

 msg+=`%0ADescuento: ${codigoAplicado || "Ninguno"}%0A`;
 msg+=document.getElementById("totalCarrito").innerText;

 window.open("https://wa.me/58752291?text="+msg);
}

/* RECARGA SALDO */
function recargarSaldo(){
 let metodo=document.getElementById("metodoPago").value;
 if(metodo==""){
   document.getElementById("estadoRecarga").innerText="âŒ Selecciona un mÃ©todo de pago primero";
   return;
 }

 saldo+=1000;
 document.getElementById("saldoWallet").innerText=saldo+" CUP";

 document.getElementById("estadoRecarga").innerText=
 `âœ… Saldo agregado correctamente usando ${metodo}`;
}
</script>

</body>
    </html>
