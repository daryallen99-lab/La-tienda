<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CubaMarket ğŸ›’ğŸ‡¨ğŸ‡º</title>

<style>
body{
  margin:0;
  font-family:Arial;
  background:#111;
  color:white;
  text-align:center;
}
header{
  background:#000;
  padding:15px;
  font-size:25px;
  color:#00ffcc;
}
.container{
  max-width:900px;
  margin:auto;
  padding:20px;
}
.card{
  background:#1a1a1a;
  padding:15px;
  margin:15px;
  border-radius:15px;
  box-shadow:0 0 10px rgba(0,255,200,0.3);
}
input{
  width:90%;
  padding:10px;
  margin:10px;
  border-radius:10px;
  border:none;
}
button{
  padding:10px 15px;
  border:none;
  border-radius:10px;
  cursor:pointer;
  font-weight:bold;
  margin:5px;
}
.btn{
  background:#00ffcc;
  color:black;
}
.btn:hover{
  opacity:0.8;
}
.product{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:10px;
  border-bottom:1px solid #333;
}
.qty{
  font-size:18px;
  margin:0 10px;
}
.hidden{
  display:none;
}
</style>
</head>

<body>

<header>CubaMarket ğŸ›’ğŸ‡¨ğŸ‡º</header>

<div class="container">

<!-- LOGIN -->
<div id="loginBox" class="card">
  <h2>ğŸ” Registro / Acceso</h2>
  <input type="email" id="email" placeholder="Correo electrÃ³nico">
  <input type="password" id="password" placeholder="ContraseÃ±a">

  <button class="btn" onclick="register()">ğŸ“ Registrarme</button>
  <button class="btn" onclick="login()">ğŸ”‘ Entrar</button>
</div>

<!-- TIENDA -->
<div id="storeBox" class="hidden">

  <div class="card">
    <h2>ğŸ‘¤ Bienvenido: <span id="userEmail"></span></h2>
    <h3>ğŸ’° Saldo: <span id="balance">0</span> CUP</h3>
    <button class="btn" onclick="logout()">ğŸšª Salir</button>
  </div>

  <!-- RECARGA -->
  <div class="card">
    <h2>â• Recargar Billetera</h2>
    <input type="number" id="rechargeAmount" placeholder="Monto a recargar CUP">

    <button class="btn" onclick="sendRecharge()">ğŸ“² Solicitar por WhatsApp</button>

    <input type="text" id="codeInput" placeholder="CÃ³digo de activaciÃ³n">
    <button class="btn" onclick="activateCode()">âœ… Activar CÃ³digo</button>
  </div>

  <!-- PRODUCTOS -->
  <div class="card">
    <h2>ğŸ›ï¸ Productos</h2>
    <div id="products"></div>
    <h2>ğŸ§¾ Total: <span id="total">0</span> CUP</h2>
  </div>

</div>

</div>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } 
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";

import { getFirestore, doc, setDoc, getDoc, updateDoc } 
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAaRXhtDzipnYG1byQ8kMT-1kv16MMgrXU",
  authDomain: "cubamarket-2eb5f.firebaseapp.com",
  projectId: "cubamarket-2eb5f",
  storageBucket: "cubamarket-2eb5f.firebasestorage.app",
  messagingSenderId: "26241880663",
  appId: "1:26241880663:web:e6ae43fe3636f60857c912"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let currentUser=null;
let cart={};
let total=0;

// PRODUCTOS (30 reales aprox Cuba 2026)
const productList=[
 {name:"ğŸ— Pollo 1kg", price:1200},
 {name:"ğŸ¥š CartÃ³n de huevos", price:2500},
 {name:"ğŸš Arroz 1kg", price:500},
 {name:"ğŸ›¢ï¸ Aceite 1L", price:1800},
 {name:"ğŸ¥› Leche en polvo", price:3500},
 {name:"ğŸ Pan", price:250},
 {name:"ğŸ§€ Queso 1lb", price:2200},
 {name:"ğŸ– Carne de cerdo", price:2000},
 {name:"ğŸ Pasta", price:700},
 {name:"ğŸ¥« Salchichas", price:1500},
 {name:"ğŸ« Chocolate", price:800},
 {name:"ğŸ¥¤ Refresco", price:600},
 {name:"â˜• CafÃ©", price:2000},
 {name:"ğŸ Manzanas", price:1500},
 {name:"ğŸŒ PlÃ¡tanos", price:400},
 {name:"ğŸ§‚ Sal", price:200},
 {name:"ğŸ¬ AzÃºcar", price:450},
 {name:"ğŸ§¼ JabÃ³n", price:500},
 {name:"ğŸ§´ Shampoo", price:2500},
 {name:"ğŸª¥ Pasta dental", price:1200},
 {name:"ğŸ§» Papel sanitario", price:2000},
 {name:"ğŸ’Š Vitaminas", price:3500},
 {name:"ğŸ“± Recarga mÃ³vil", price:1000},
 {name:"ğŸ’¡ Bombillo LED", price:1800},
 {name:"ğŸª« PowerBank", price:8500},
 {name:"ğŸ§ AudÃ­fonos", price:6000},
 {name:"ğŸ“º TV 32 pulgadas", price:95000},
 {name:"â„ï¸ Ventilador", price:15000},
 {name:"ğŸ§Š Refrigerador", price:250000},
 {name:"ğŸ›µ Moto elÃ©ctrica", price:800000},
];

// MOSTRAR PRODUCTOS
function loadProducts(){
 let html="";
 productList.forEach((p,i)=>{
   html+=`
   <div class="product">
     <span>${p.name} - ${p.price} CUP</span>
     <div>
       <button onclick="changeQty(${i},-1)">â–</button>
       <span class="qty" id="qty${i}">0</span>
       <button onclick="changeQty(${i},1)">â•</button>
     </div>
   </div>`;
 });
 document.getElementById("products").innerHTML=html;
}
loadProducts();

// CAMBIAR CANTIDAD
window.changeQty=(i,delta)=>{
 if(!cart[i]) cart[i]=0;
 cart[i]+=delta;
 if(cart[i]<0) cart[i]=0;
 document.getElementById("qty"+i).innerText=cart[i];
 calculateTotal();
};

// CALCULAR TOTAL
function calculateTotal(){
 total=0;
 for(let i in cart){
   total+=cart[i]*productList[i].price;
 }
 document.getElementById("total").innerText=total;
}

// REGISTRO
window.register=async()=>{
 const email=document.getElementById("email").value;
 const pass=document.getElementById("password").value;

 const userCred=await createUserWithEmailAndPassword(auth,email,pass);

 await setDoc(doc(db,"users",userCred.user.uid),{
   email:email,
   balance:0
 });

 alert("âœ… Usuario registrado!");
};

// LOGIN
window.login=async()=>{
 const email=document.getElementById("email").value;
 const pass=document.getElementById("password").value;

 await signInWithEmailAndPassword(auth,email,pass);
};

// LOGOUT
window.logout=async()=>{
 await signOut(auth);
};

// SESIÃ“N
onAuthStateChanged(auth,async(user)=>{
 if(user){
   currentUser=user;
   document.getElementById("loginBox").classList.add("hidden");
   document.getElementById("storeBox").classList.remove("hidden");
   document.getElementById("userEmail").innerText=user.email;

   const snap=await getDoc(doc(db,"users",user.uid));
   document.getElementById("balance").innerText=snap.data().balance;
 }else{
   document.getElementById("loginBox").classList.remove("hidden");
   document.getElementById("storeBox").classList.add("hidden");
 }
});

// RECARGA WHATSAPP
window.sendRecharge=()=>{
 const amount=document.getElementById("rechargeAmount").value;
 const msg=`Hola, quiero recargar mi billetera CubaMarket con ${amount} CUP`;
 window.open("https://wa.me/5353420021?text="+encodeURIComponent(msg));
};

// ACTIVAR CÃ“DIGO MANUAL
window.activateCode=async()=>{
 const code=document.getElementById("codeInput").value;

 if(code==="CUBA2026"){
   const amount=parseInt(document.getElementById("rechargeAmount").value);

   const ref=doc(db,"users",currentUser.uid);
   const snap=await getDoc(ref);

   let newBal=snap.data().balance+amount;

   await updateDoc(ref,{balance:newBal});
   document.getElementById("balance").innerText=newBal;

   alert("âœ… Saldo agregado correctamente!");
 }else{
   alert("âŒ CÃ³digo invÃ¡lido");
 }
};
</script>

</body>
</html>
